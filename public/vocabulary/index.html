<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Fiszki EN-PL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin:0;
      font:16px/1.5 "Inter", system-ui, Segoe UI, Roboto, Arial, sans-serif;
      background:#f5f7fb; color:#111827;
    }
    .flashcard-wrapper { text-align: center; margin: 2em auto; max-width: 600px; }
    .nav-controls { margin: 14px 0 0; }
    .nav-controls button {
      padding: 10px 16px;
      margin: 4px;
      border: none;
      border-radius: 6px;
      background: #eee;
      font-weight: bold;
      cursor: pointer;
    }
    .flashcard {
      width: 100%;
      height: 200px;
      perspective: 1000px;
      margin: 0 auto;
      position: relative;
      transition: transform 0.4s ease, opacity 0.4s ease, background 0.4s ease;
    }
    .card-inner {
      width: 100%;
      height: 100%;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      position: relative;
    }
    .flipped .card-inner { transform: rotateY(180deg); }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      border: 2px solid #ccc;
      border-radius: 12px;
      font-size: 24px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      padding: 20px;
      box-sizing: border-box;
      color: #111;
    }
    .card-back { background: #e0f2fe; transform: rotateY(180deg); }
    .speak-btn {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 20px;
      cursor: pointer;
      background: none;
      border: none;
    }
    .swipe-left { transform: translateX(-120%) rotate(-15deg); opacity: 0; background:#fecaca !important; }
    .swipe-right { transform: translateX(120%) rotate(15deg); opacity: 0; background:#bbf7d0 !important; }

    .practice-container { text-align:left; margin-top:20px; }
    .practice-word { font-size:22px; font-weight:bold; margin-bottom:10px; }

    .typing-wrap { position: relative; }
    .practice-input {
      width:100%;
      font-size:18px;
      padding:8px;
      border:2px solid #facc15 !important;
      outline:none;
      border-radius:8px;
      background: transparent;
      color: transparent;
      caret-color: #111827;
      position: relative;
      z-index: 2;
      box-sizing: border-box;
    }
    .highlighter {
      position: absolute;
      inset: 0;
      padding: 8px;
      border-radius: 8px;
      font-size: 18px;
      font-family: inherit;
      line-height: 1.4;
      white-space: pre-wrap;
      pointer-events: none;
      z-index: 1;
      background: white;
    }
    .highlighter .wrong { color:#dc2626; }
    .highlighter .correct { color:#16a34a; }

    .practice-btn {
      padding:10px 16px; border:none; border-radius:6px;
      background:#3b82f6; color:white; font-weight:bold; cursor:pointer;
    }
    .idk-link { float:right; color:teal; cursor:pointer; font-size:14px; }

    .feedback {
      margin-top: 8px;
      font-size: 18px;
      font-family: inherit;
    }

    /* MENU CUSTOM */
    .menu {
      position: relative;
      display: inline-block;
    }
    #menu-btn {
      padding: 6px 12px;
      font-size: 16px;
      border: 2px solid #ccc;
      border-radius: 8px;
      background: #fff;
      cursor: pointer;
    }
    #menu-list {
      list-style: none;
      margin: 0;
      padding: 0;
      position: absolute;
      right: 0;
      top: 100%;
      background: white;
      border: 2px solid #ccc;
      border-radius: 8px;
      width: max-content;
      z-index: 100;
    }
    #menu-list li {
      padding: 8px 12px;
      cursor: pointer;
    }
    #menu-list li:hover {
      background: #f0f0f0;
    }
    .hidden { display: none; }

    /* podczas przesuwania kolorujemy tak≈ºe ≈õrodek */
    .swipe-left .card-front,
    .swipe-left .card-back { background: #fecaca !important; }
    .swipe-right .card-front,
    .swipe-right .card-back { background: #bbf7d0 !important; }
  </style>
</head>
<body>
  <div class="flashcard-wrapper">
    <div style="margin-bottom:10px; text-align:right;">
      <div class="menu">
        <button id="menu-btn">Menu‚öôÔ∏è</button>
        <ul id="menu-list" class="hidden"></ul>
      </div>
    </div>

    <div id="card-area">
      <div class="flashcard" id="card"></div>
    </div>

    <div class="nav-controls">
      <button id="again-btn">‚¨ÖÔ∏è WciƒÖ≈º siƒô uczƒô</button>
      <button id="know-btn">Umiem ‚û°Ô∏è</button>
    </div>

    <div id="message" style="margin-top:20px; font-weight:bold;"></div>
  </div>

<script>


  (function () {
  const MODULE_ID = "module_1";
  const LESSON_ID = "module_1__vocabulary__app";
  let lessonCompletedSent = false;

 


  const words = [
  { en: "here is to my sister", pl: "za mojƒÖ siostrƒô" },
  { en: "newly appointed", pl: "nowo mianowana" },
  { en: "in charge of purchasing", pl: "odpowiedzialna za zakupy" },
  { en: "her own little desk", pl: "jej w≈Çasne ma≈Çe biurko" },
  { en: "when Roland's not there", pl: "kiedy Rolanda nie ma" },
  { en: "beeper", pl: "pager" },
  { en: "Are you ready to order?", pl: "Czy jeste≈õcie gotowi, ≈ºeby zam√≥wiƒá?" },
  { en: "We haven't even looked yet.", pl: "Jeszcze nawet nie spojrzeli≈õmy." },
  { en: "just let me know", pl: "po prostu daj mi znaƒá" },
  { en: "I'll be right over there on the edge of my seat.", pl: "Bƒôdƒô tu≈º obok, czekajƒÖc w napiƒôciu." },
  { en: "look at these prices", pl: "sp√≥jrz na te ceny" },
  { en: "what are these?", pl: "co to jest?" },
  { en: "famous chickens", pl: "s≈Çynne kurczaki" },
  { en: "Sorry I'm late.", pl: "Przepraszam za sp√≥≈∫nienie." },
  { en: "Congratulations", pl: "Gratulacje" },
  { en: "How incredible was my afternoon", pl: "Jak niesamowite by≈Ço moje popo≈Çudnie" },
  { en: "pretty incredible", pl: "ca≈Çkiem niesamowite" },
  { en: "according to the message she left for you", pl: "sƒÖdzƒÖc po wiadomo≈õci, kt√≥rƒÖ ci zostawi≈Ça" },
  { en: "leave a message on a machine", pl: "zostawiƒá wiadomo≈õƒá na sekretarce" },
  { en: "I had to tell her", pl: "musia≈Çem jej powiedzieƒá" },
  { en: "Do I dare ask?", pl: "Czy mogƒô zapytaƒá?" },
  { en: "I'll start with", pl: "Zacznƒô od" },
  { en: "I'll have the grilled prawns", pl: "Wezmƒô grillowane krewetki" },
  { en: "That sounds great.", pl: "Brzmi ≈õwietnie." },
  { en: "Same for me.", pl: "Dla mnie to samo." },
  { en: "And for the gentleman?", pl: "A dla pana?" },
  { en: "Yeah, I'll have the Thai chicken pizza.", pl: "Tak, wezmƒô tajskƒÖ pizzƒô z kurczakiem." },
  { en: "without the nuts and leeks", pl: "bez orzech√≥w i por√≥w" },
  { en: "is it cheaper?", pl: "bƒôdzie taniej?" },
  { en: "You'd think, wouldn't you?", pl: "Mo≈ºna by tak pomy≈õleƒá, prawda?" },
  { en: "side salad", pl: "sa≈Çatka jako dodatek" },
  { en: "And what would that be on the side of?", pl: "A do czego mia≈Çby byƒá ten dodatek?" },
  { en: "Why don't you just put it right here next to my water?", pl: "Mo≈ºe po prostu po≈Ç√≥≈º jƒÖ tutaj, obok mojej wody?" },
  { en: "And for you?", pl: "A dla ciebie?" },
  { en: "I'm going to have a cup of the cucumber soup.", pl: "Wezmƒô fili≈ºankƒô zupy og√≥rkowej." },
  { en: "take care", pl: "trzymaj siƒô" },
  { en: "Anything else?", pl: "Co≈õ jeszcze?" },
  { en: "how about", pl: "a mo≈ºe" },
  { en: "verse", pl: "zwrotka" },
  { en: "sneeze", pl: "kichnƒÖƒá" }
];


  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

const KEY_FLASH = "flashcards-queue-m1";
const KEY_PRACTICE = "practice-queue-m1";


  let frontLang = "en";
  let flipped = false;
  let queueFlashcards;
  let queuePractice;

     async function tryAutoCompleteLesson() {
    if (lessonCompletedSent) return;

    const flashDone = queueFlashcards.length === 0;
    const practiceDone = queuePractice.length === 0;

    // ANY: fiszki LUB pisownia
    if (!flashDone && !practiceDone) return;

    lessonCompletedSent = true;

    try {
      await fetch("/api/lesson-complete", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify({
          moduleId: MODULE_ID,
          lessonId: LESSON_ID
        })
      });
    } catch (err) {
      console.error("Vocabulary auto-complete failed", err);
      lessonCompletedSent = false;
    }
  }
  let currentCard = null;
  let selectedVoice = null;
  let practiceMode = false;

  // load saved queues
  let savedFlash = localStorage.getItem(KEY_FLASH);
  if (savedFlash) {
    try { queueFlashcards = JSON.parse(savedFlash); }
    catch { queueFlashcards = shuffleArray([...words]); }
  } else {
    queueFlashcards = shuffleArray([...words]);
  }

  let savedPractice = localStorage.getItem(KEY_PRACTICE);
  if (savedPractice) {
    try { queuePractice = JSON.parse(savedPractice); }
    catch { queuePractice = shuffleArray([...words]); }
  } else {
    queuePractice = shuffleArray([...words]);
  }

  function saveFlashcards() {
    localStorage.setItem(KEY_FLASH, JSON.stringify(queueFlashcards));
  }
  function savePractice() {
    localStorage.setItem(KEY_PRACTICE, JSON.stringify(queuePractice));
  }

  function loadVoices() {
    const voices = speechSynthesis.getVoices();
    if (!voices.length) { setTimeout(loadVoices, 250); return; }
    selectedVoice = voices.find(v => /Google (US|UK) English/.test(v.name));
    if (!selectedVoice) selectedVoice = voices.find(v => v.lang.startsWith("en"));
  }
  window.speechSynthesis.onvoiceschanged = loadVoices;
  loadVoices();

  const cardContainer = document.getElementById("card");
  const againBtn = document.getElementById("again-btn");
  const knowBtn = document.getElementById("know-btn");
  const message = document.getElementById("message");

  // MENU refs
  const menuBtn  = document.getElementById("menu-btn");
  const menuList = document.getElementById("menu-list");

  // === RENDER MENU (dynamicznie wg trybu) ===
  function renderMenu() {
    if (practiceMode) {
      // tryb ƒáwiczenia pisowni ‚Üí 3 opcje
      menuList.innerHTML = `
        <li data-action="flashcards">Fiszki</li>
        <li data-action="reset">Wyzeruj postƒôp fiszek</li>
        <li data-action="resetPractice">Wyzeruj postƒôp pisowni</li>
      `;
    } else {
      // tryb fiszek ‚Üí pe≈Çne menu
      menuList.innerHTML = `
        <li data-action="flashcards">Fiszki</li>
        <li data-action="en">Angielski z przodu</li>
        <li data-action="pl">Polski z przodu</li>
        <li data-action="reset">Wyzeruj postƒôp fiszek</li>
        <li data-action="resetPractice">Wyzeruj postƒôp pisowni</li>
        <li data-action="practice">ƒÜwiczenie pisowni</li>
      `;
    }
  }

  // fiszki: klik karty / g≈Ço≈õniczka
  cardContainer.addEventListener("click", (e) => {
    if (practiceMode) return;
    if (e.target.closest(".speak-btn")) {
      e.stopPropagation();
      e.preventDefault();
      const utterance = new SpeechSynthesisUtterance(currentCard.en);
      utterance.lang = "en-US";
      if (selectedVoice) utterance.voice = selectedVoice;
      speechSynthesis.speak(utterance);
      return;
    }
    flipped = !flipped;
    cardContainer.className = "flashcard" + (flipped ? " flipped" : "");
  });

  function renderCard() {
    practiceMode = false;
    document.querySelector(".nav-controls").style.display = "block";
    renderMenu();

    if (queueFlashcards.length === 0) {
      message.textContent = "";
      cardContainer.className = "flashcard";
      cardContainer.innerHTML = `
        <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%;">
          <div style="font-size:20px; font-weight:bold; margin-bottom:20px;">
            üéâ Gratulacje! Przerobi≈Çe≈õ wszystkie fiszki.
          </div>
          <button id="restart-btn" class="practice-btn">Zacznij od nowa</button>
        </div>
      `;
      document.getElementById("restart-btn").addEventListener("click", () => {
        queueFlashcards = shuffleArray([...words]);
        saveFlashcards();
        renderCard();
      });
            tryAutoCompleteLesson();

      return;
    }
    message.textContent = "";
    currentCard = queueFlashcards[0];
    flipped = false;
    cardContainer.className = "flashcard";
    cardContainer.innerHTML = `
      <div class="card-inner">
        <div class="card-front">
          ${frontLang === "en" ? currentCard.en : currentCard.pl}
          ${frontLang === "en" ? `<button type="button" class="speak-btn">üîä</button>` : ""}
        </div>
        <div class="card-back">
          ${frontLang === "en" ? currentCard.pl : currentCard.en}
          ${frontLang === "pl" ? `<button type="button" class="speak-btn">üîä</button>` : ""}
        </div>
      </div>
    `;
  }

  function swipeCard(direction) {
    if (!currentCard) return;
    if (direction === "left") {
      cardContainer.classList.add("swipe-left");
      setTimeout(() => {
        queueFlashcards.push(queueFlashcards.shift());
        saveFlashcards();
        cardContainer.classList.remove("swipe-left");
        renderCard();
      }, 400);
    } else if (direction === "right") {
      cardContainer.classList.add("swipe-right");
      setTimeout(() => {
        queueFlashcards.shift();
        saveFlashcards();
        cardContainer.classList.remove("swipe-right");
        renderCard();
      }, 400);
    }
  }

  // gesty
  let startX = 0;
  cardContainer.addEventListener("touchstart", (e) => {
    startX = e.touches[0].clientX;
  });
  cardContainer.addEventListener("touchend", (e) => {
    const endX = e.changedTouches[0].clientX;
    const diffX = endX - startX;
    if (Math.abs(diffX) > 50) {
      if (diffX > 0) swipeCard("right");
      else swipeCard("left");
    }
  });

  // tryb ƒáwiczenia pisowni
  function renderPractice() {
    practiceMode = true;
    document.querySelector(".nav-controls").style.display = "none";
    renderMenu();

    cardContainer.innerHTML = "";
    message.textContent = "";
  if (queuePractice.length === 0) {
  cardContainer.innerHTML = "üéâ Gratulacje! Przerobi≈Çe≈õ wszystkie s≈Çowa w ƒáwiczeniu pisowni.";
  tryAutoCompleteLesson();
  return;
}

    const polishWord = queuePractice[0].pl;
    cardContainer.innerHTML = `
      <div class="practice-container">
        <div class="practice-word">
          ${polishWord}
          <span id="idk" class="idk-link">Nie wiem</span>
        </div>
        <div class="typing-wrap">
          <div id="hl" class="highlighter" aria-hidden="true"></div>
          <input id="answer" type="text" class="practice-input" placeholder="(ANGIELSKI)" autocomplete="off">
        </div>
        <div id="correct-answer" class="feedback"></div>
        <div style="margin-top:10px; text-align:right;">
          <button id="check-btn" class="practice-btn">Odpowiedz</button>
        </div>
      </div>
    `;

    const answerInput = document.getElementById("answer");
    const hl          = document.getElementById("hl");
    const correctDiv  = document.getElementById("correct-answer");
    const checkBtn    = document.getElementById("check-btn");
    const correctRaw  = queuePractice[0].en;
    const correctLC   = correctRaw.toLowerCase();

    answerInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        checkBtn.click();
      }
    });

    const esc = (s) => (s || "").replace(/[&<>"']/g, c => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[c]));
    answerInput.addEventListener("input", () => {
      const userRaw = answerInput.value;
      let out = "";
      for (let i = 0; i < userRaw.length; i++) {
        if (userRaw[i].toLowerCase() === correctLC[i]) {
          out += `<span class="correct">${esc(userRaw[i])}</span>`;
        } else {
          out += `<span class="wrong">${esc(userRaw[i])}</span>`;
        }
      }
      hl.innerHTML = out;
    });

    checkBtn.onclick = () => {
      const userRaw = answerInput.value.trim().toLowerCase();
      if (!userRaw) {
        correctDiv.textContent = `${correctRaw}`;
        setTimeout(() => { correctDiv.textContent = ""; answerInput.value = ""; hl.innerHTML=""; answerInput.focus(); }, 4000);
        return;
      }
      if (userRaw === correctLC) {
        correctDiv.textContent = `‚úîÔ∏è ${correctRaw}`;
        setTimeout(() => {
          queuePractice.shift();
          savePractice();
          renderPractice();
        }, 1000);
      } else {
        correctDiv.textContent = `${correctRaw}`;
        setTimeout(() => { correctDiv.textContent = ""; answerInput.value = ""; hl.innerHTML=""; answerInput.focus(); }, 4000);
      }
    };

    document.getElementById("idk").onclick = () => {
      correctDiv.textContent = `${correctRaw}`;
      setTimeout(() => {
        correctDiv.textContent = "";
        answerInput.value = "";
        hl.innerHTML = "";
        answerInput.focus();
      }, 3000);
    };

    answerInput.focus();
  }

  // obs≈Çuga menu (otwieranie / zamykanie / klik pozycji)
  menuBtn.addEventListener("click", () => {
    menuList.classList.toggle("hidden");
  });
  document.addEventListener("click", (e) => {
    if (!e.target.closest(".menu")) {
      menuList.classList.add("hidden");
    }
  });
  menuList.addEventListener("click", (e) => {
    if (e.target.tagName !== "LI") return;
    const val = e.target.dataset.action;
    menuList.classList.add("hidden");

    if (val === "flashcards") renderCard();
    if (val === "en") { frontLang = "en"; renderCard(); }
    if (val === "pl") { frontLang = "pl"; renderCard(); }
    if (val === "reset") { queueFlashcards = shuffleArray([...words]); saveFlashcards(); renderCard(); }
    if (val === "resetPractice") { queuePractice = shuffleArray([...words]); savePractice(); renderPractice(); }
    if (val === "practice") renderPractice();
  });

  againBtn.addEventListener("click", () => swipeCard("left"));
  knowBtn.addEventListener("click", () => swipeCard("right"));

  // start
  renderMenu();   // ustaw menu do trybu startowego
  renderCard();   // wejd≈∫ w fiszki na start
})();

  

</script>
</body>
</html>
